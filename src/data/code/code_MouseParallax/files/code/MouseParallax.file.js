const generateStyle = (h, w) => {
  // generates a style object with the width and height of the component provided
  let style = {};
  const addToStyle = (value, key) => {
    if (value) {
      style = {
        ...style,
        [key]: value,
      };
    }
  };
  addToStyle(h, 'height');
  addToStyle(w, 'width');
  if (Object.keys(style).length === 0) {
    console.warn('No height or width provided');
  }
  return style;
};

const defaultFactor = { x: 0.002, y: 0.005 };

const MouseParallax = ({
  children,
  // width and height to be applied to child and container components
  width,
  height,
  factor = defaultFactor,
  // extra styles to apply to container component
  containerStyles = {},
  // function helper to modify the styles created by the generated styles.
  // it can also be a style object to combine with the styles
  // generated by generateStyle()
  updateStyles = () => ({}),
}) => {
  const { x = 0.002, y = 0.005 } = factor;
  // gets if the device viewing the web page did trigger a touch event.
  // if so, the MouseParallax component is deactivated to increase performance.
  const { touch } = useContext(LayoutContext);
  const styles = useMemo(() => generateStyle(height, width), [height, width]);
  return (
    <MouseParallaxContainer
      enabled={!touch}
      useWindowMouseEvents
      containerStyles={{
        ...styles,
        ...containerStyles,
      }}
    >
      <MouseParallaxChild
        factorX={x}
        factorY={y}
        updateStyles={(o) => {
          if (typeof updateStyles === 'function') {
            return {
              ...styles,
              ...updateStyles(o),
            };
          } else if (typeof updateStyles === 'object') {
            return {
              ...styles,
              ...updateStyles,
            };
          }
          return styles;
        }}
      >
        {children}
      </MouseParallaxChild>
    </MouseParallaxContainer>
  );
};
